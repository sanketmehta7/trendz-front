<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>trends - Top 10 twitter trends wall</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="https://storage.googleapis.com/code.getmdl.io/1.0.6/material.brown-indigo.min.css" />
  <script src="https://storage.googleapis.com/code.getmdl.io/1.0.6/material.min.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" type="text/css" href="css/style.css"/>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-alpha1/jquery.js"></script>
  
  <script type="text/javascript">
  	var region = typeof localStorage.region!=='undefined'?localStorage.region:1;//23424848
      function loadData(){
        region = typeof localStorage.region!=='undefined'?localStorage.region:1;

        $(".app").html('<div id="p2" class="mdl-progress mdl-js-progress mdl-progress__indeterminate mdl-spinner--single-color"></div>');
        $.ajax({
        url:"http://nodejs-trendz.rhcloud.com/dir_"+region+"/index.json?"+Date.parse(new Date()),
        method:"get",
        success:function(res){
          var data = res;
          var tmphtml = "<div class='mdl-grid'>";
          var width100 = 100;
          var gridArr = [[5,4,3],[4,3,5],[3,5,4],[3,4,5],[5,3,4],[4,5,3]];
          var gridMapSmallDevice = {5:12,4:12,3:12};
          var cnt = 0;
          var topcnt =0;
          var randIndex = parseInt(Math.random()*gridArr.length);
          var tmpGrid = gridArr[randIndex];
          for(var key in data.trendsData){
            
            if(cnt%3==0){
              cnt=0;
              tmpGrid = gridArr[parseInt(Math.random()*gridArr.length)];
            }

            if(data.trendsData[key].type=='image')
              var innerMedia = '<img src="'+data.trendsData[key].tweet.entities.media[0].media_url+'"/>';
            else if(data.trendsData[key].type=='video')
              var innerMedia = '<video src="'+data.trendsData[key].tweet.entities.media[0].media_url+'"/>';
            else 
              var innerMedia = '<div>&nbsp;<br/>  &nbsp;</div>';

            var mediaBlock = "<div class='media "+data.trendsData[key].type+"'>"+innerMedia+"</div>";

            var titleBlock = "<div class='topic mdl-card__title'><h2 class='mdl-card__title-text'>"+myTitle(decodeURIComponent(data.trendsData[key].query))+"</h2>"+mediaBlock+"</div>";

            var buttonBar = '<div class="mdl-card__actions mdl-card--border">'+
                                
                                  '<a href="trendAlone.html?index='+topcnt+'" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--accent mdl-button--raised">'+
                                   'View tweets'+
                                  '</a>&nbsp;'+
                                  '<a href="http://twitter.com/intent/tweet?text='+data.trendsData[key].query+'" target="_blank" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--accent">'+
                                                       'Tweet this trend'+
                                                      '</a>'+
                                '</div>';
            var sharMenu = '<div class="mdl-card__menu">'+
                              '<button class="mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect">'+
                                '<i class="material-icons">share</i>'+
                              '</button>'+
                            '</div>';

            var tweetBlock = '<div class="twitter-tweet mdl-card__supporting-text"  id="'+data.trendsData[key].tweet.id+'">'+
                    '<p >'+data.trendsData[key].tweet.text+'</p>'+
                    '<a class="userlink" href="http://twitter.com/'+data.trendsData[key].tweet.user.screen_name+'" target="_blank">â€” '+data.trendsData[key].tweet.user.name+' (@'+data.trendsData[key].tweet.user.screen_name+')</a>'+
                    '</div>';
                    //console.log(tweetBlock);

            if(data.trendsData.hasOwnProperty(key)){
              tmphtml += "<div  class='mdl-grid mdl-cell indexgrid mdl-cell--"+tmpGrid[cnt]+"-col mdl-cell--"+gridMapSmallDevice[tmpGrid[cnt]]+"-col-tablet demo-card-wide mdl-card mdl-shadow--2dp post-"+data.trendsData[key].type+"'>"+titleBlock+tweetBlock+buttonBar+"</div>";            
            }
            cnt++;
            topcnt++;
          }
          tmphtml += "</div>";
          //console.log(tmphtml);
          $(".app").html(tmphtml);
          $("#reg_"+region).addClass("active");
          var elem = document.querySelector('.app');
        
        },
        error:function(err){
          alert("Somthing wrong, unable to fetch data, try reloading browser.");
        }
      })
    }
    loadData();
  	
    function myTitle(str){
      str = str.replace(/\"/g,'');
      str = str.replace(/\+/g,' ');
      return str;
    }
    function change(regionWOID){
      localStorage.region = regionWOID;
      console.log(localStorage.region );
      $(".mdl-menu__item").removeClass("active");

      loadData();
    }

  </script>
</head>
<body>
	
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
    <header class="mdl-layout__header">
      <div class="mdl-layout-icon"></div>
      <div class="mdl-layout__header-row">
        <span class="mdl-layout__title">
          <a href='#'><img src='./logo.png' width='32px'/> twitter trends</a>
        </span>
        <div class="mdl-layout-spacer"></div>
        <nav class="mdl-navigation">
          <button id="menu-speed" class="mdl-button mdl-js-button ">
            Change Region
          </button>
          <ul class="mdl-menu mdl-js-menu mdl-menu--bottom-right" for="menu-speed">
            <li id='reg_1' class="mdl-menu__item" onclick='change(1)'><img src='./img/globe-20.png'/> &nbsp;World</li>
            <li id='reg_23424848' class="mdl-menu__item" onclick='change(23424848)'><img src='./img/flag_india.png' /> &nbsp;India</li>
            <li id='reg_23424977' class="mdl-menu__item" onclick='change(23424977)'><img src='./img/flag_usa.png' /> &nbsp;United States</li>
            <li id='reg_23424768' class="mdl-menu__item" onclick='change(23424768)'><img src='./img/flag_brazil.png' /> &nbsp;Brazil</li>
          </ul>
        </nav>
      </div>
    </header>
    <main class="mdl-layout__content">
      <div class="app" id="app">
        <div id="p2" class="mdl-progress mdl-js-progress mdl-progress__indeterminate mdl-spinner--single-color"></div>
      </div>
    </main>
  </div>
	
</body>
</html>
